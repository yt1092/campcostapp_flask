<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>割り勘計算アプリ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .container { max-width: 700px; margin-top: 40px; }
    .member-card { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
  </style>
</head>
<body>
<div class="container">
  <h3 class="text-center mb-4 fw-bold text-primary">割り勘計算アプリ</h3>
  <form method="POST">

    <!-- 上部の金額入力欄 -->
    <div class="card p-3 mb-3">
      <label class="form-label">食費</label>
      <input type="number" name="food" class="form-control mb-2" value="{{ food|int }}">
      <label class="form-label">交通費</label>
      <input type="number" name="transport" class="form-control mb-2" value="{{ transport|int }}">
      <label class="form-label">キャンプ場</label>
      <input type="number" name="camp" class="form-control" value="{{ camp|int }}">
    </div>

    <!-- 人数調整 -->
    <div class="d-flex align-items-center mb-3">
      <label class="me-3 mb-0">人数：</label>
      <input type="number" name="people" id="people" class="form-control w-auto me-2" value="{{ people }}" min="1">
      <button type="button" class="btn btn-outline-primary btn-sm me-1" id="add-person">＋</button>
      <button type="button" class="btn btn-outline-secondary btn-sm" id="remove-person">－</button>
    </div>

    <!-- メンバー -->
    <div id="members">
      {% for i in range(people) %}
      <div class="member-card">
        <label class="form-label">メンバー {{ i+1 }} 名前</label>
        <input type="text" class="form-control mb-2" name="name_{{ i }}" value="{{ names[i] }}">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="food_exempt_{{ i }}" {% if food_ex[i] %}checked{% endif %}>
          <label class="form-check-label">食費免除</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="transport_exempt_{{ i }}" {% if transport_ex[i] %}checked{% endif %}>
          <label class="form-check-label">交通免除</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="camp_exempt_{{ i }}" {% if camp_ex[i] %}checked{% endif %}>
          <label class="form-check-label">キャンプ免除</label>
        </div>
      </div>
      {% endfor %}
    </div>

    <button type="submit" class="btn btn-primary w-100 mt-2">計算する</button>
  </form>

  {% if results %}
  <div class="card mt-4 p-3">
    <h5 class="fw-bold mb-2">結果</h5>
    <ul class="list-group">
      {% for i in range(people) %}
      <li class="list-group-item d-flex justify-content-between">
        <span>{{ names[i] }}</span>
        <strong>{{ "{:,}".format(results[i]) }} 円</strong>
      </li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}
</div>

<script>
document.getElementById('add-person').addEventListener('click', () => {
  const input = document.getElementById('people');
  input.value = parseInt(input.value) + 1;
  input.form.submit();
});

document.getElementById('remove-person').addEventListener('click', () => {
  const input = document.getElementById('people');
  input.value = Math.max(1, parseInt(input.value) - 1);
  input.form.submit();
});
</script>
</body>
</html>
